<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-light: #7c93ff;
            --success: #48bb78;
            --warning: #ed8936;
            --error: #f56565;
            --text: #e2e8f0;
            --text-light: #a0aec0;
            --background: #0f172a;
            --card: #1e293b;
            --card-hover: #2d3748;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary-light);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px var(--shadow);
        }

        .card:hover {
            transform: translateY(-5px);
            background: var(--card-hover);
            box-shadow: 0 15px 35px var(--shadow);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-icon {
            font-size: 1.8rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text);
        }

        .card-description {
            color: var(--text-light);
            margin-bottom: 25px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .control-input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .control-input::placeholder {
            color: var(--text-light);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .role-card {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .role-card.selected {
            background: rgba(102, 126, 234, 0.15);
            border-color: var(--primary);
        }

        .role-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .role-icon {
            font-size: 1.2rem;
        }

        .role-name {
            font-weight: 600;
            color: var(--text);
        }

        .role-level {
            margin-left: auto;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .role-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .role-access {
            font-size: 0.85rem;
            color: var(--success);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
            animation: pulse 2s infinite;
        }

        .status-dot.connecting {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }

        .status-dot.disconnected {
            background: var(--error);
            box-shadow: 0 0 10px var(--error);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .loading-dots {
            display: inline-block;
            width: 20px;
            height: 20px;
            position: relative;
        }

        .loading-dots::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 0;
            left: 0;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .save-all-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 36px;
            background: linear-gradient(135deg, var(--success), #38a169);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .save-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(72, 187, 120, 0.4);
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
            .save-all-btn {
                bottom: 20px;
                right: 20px;
                padding: 14px 28px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</p>
        </div>

        <!-- Section 1: Directory Settings -->
        <div class="section">
            <h2 class="section-title">üìÇ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è</h2>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìÇ</span>
                        <span class="card-title">–ü—É—Ç—å –∫ –ø–∞–ø–∫–µ Songs</span>
                    </div>
                    <p class="card-description">
                        –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç
                    </p>
                    <div class="control-group">
                        <label class="control-label">–ü—É—Ç—å –∫ –ø–∞–ø–∫–µ Songs</label>
                        <input type="text" class="control-input" id="folder-path"
                               value="D:\osu!\Songs"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å...">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="saveDirectorySettings()">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Downloader Settings -->
        <div class="section">
            <h2 class="section-title">üì• –ó–∞–≥—Ä—É–∑—á–∏–∫</h2>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìè</span>
                        <span class="card-title">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞</span>
                    </div>
                    <p class="card-description">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–∫–∞—á–∏–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
                    </p>
                    <div class="control-group">
                        <label class="control-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (MB)</label>
                        <input type="number" class="control-input" id="file-size"
                               value="350" min="50" max="1024">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="saveFileSize()">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üîó</span>
                        <span class="card-title">–ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏</span>
                    </div>
                    <p class="card-description">
                        –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç
                    </p>
                    <div class="control-group">
                        <label class="control-label">–í–µ–±—Å–∞–π—Ç</label>
                        <input type="text" class="control-input" id="website-address"
                               placeholder="catboy.best">
                    </div>
                    <div class="control-group">
                        <label class="control-label">–ü—Ä–µ—Ñ–∏–∫—Å –ø—É—Ç–∏</label>
                        <input type="text" class="control-input" id="path-prefix"
                               placeholder="/d/">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="saveDownloaderSource()">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Chat Connection -->
        <div class="section">
            <h2 class="section-title">üí¨ –ß–∞—Ç</h2>
            <div class="connection-status">
                <div class="status-dot disconnected" id="connection-status"></div>
                <span id="connection-text">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
            </div>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üîÑ</span>
                        <span class="card-title">–ê–≤—Ç–æ–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</span>
                    </div>
                    <p class="card-description">
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                    </p>
                    <div class="control-group">
                        <label class="control-label">–ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)</label>
                        <input type="number" class="control-input" id="reconnect-delay"
                               value="30" min="10" max="120">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="saveReconnectTimeout()">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üí¨</span>
                        <span class="card-title">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á–∞—Ç—É</span>
                    </div>
                    <p class="card-description">
                        –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                    </p>
                    <div class="control-group">
                        <label class="control-label">–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞</label>
                        <input type="text" class="control-input" id="chat-room"
                               placeholder="darkyisoffline">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="connectToChat()" id="connect-btn">
                            –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 4: User Management -->
        <div class="section">
            <h2 class="section-title">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üéñÔ∏è</span>
                        <span class="card-title">–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞</span>
                    </div>
                    <p class="card-description">
                        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–º–∞–Ω–¥–∞–º
                    </p>
                    <div class="control-group">
                        <label class="control-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å:</label>
                        <div id="role-options">
                            <!-- Roles will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">–¢–æ–ª—å–∫–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</label>
                        <select class="control-input" id="trusted-only">
                            <option value="false">‚ùå –í—ã–∫–ª—é—á–µ–Ω–æ - –¥–æ—Å—Ç—É–ø –ø–æ —Ä–æ–ª—è–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                            <option value="true">‚úÖ –í–∫–ª—é—á–µ–Ω–æ - —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ø–∏—Å–∫–∞ Allowed Users</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="saveAccessSettings()">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">‚úÖ</span>
                        <span class="card-title">–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </div>
                    <p class="card-description">
                        –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫
                    </p>
                    <div class="control-group">
                        <label class="control-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" class="control-input" id="allow-user"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ username...">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="allowUser(this)">
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button class="action-btn btn-secondary" onclick="removeAllowedUser(this)">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">‚ùå</span>
                        <span class="card-title">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </div>
                    <p class="card-description">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞
                    </p>
                    <div class="control-group">
                        <label class="control-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" class="control-input" id="block-user"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ username...">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="blockUser(this)">
                            –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="action-btn btn-secondary" onclick="removeBlockedUser(this)">
                            –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="save-all-btn" onclick="saveAllSettings()">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    </button>

    <script>
        const SERVER_URL = 'http://127.0.0.1:23140';
        let selectedRoleLevel = 2; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é VIP
        let isConnected = false;

        // –î–∞–Ω–Ω—ã–µ –æ —Ä–æ–ª—è—Ö
        const roles = [
            {
                level: 0,
                icon: 'üîì',
                name: '–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                description: '–õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∞—Ç–∞',
                access: '–ö—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø: –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∞—Ç–∞',
                when: '–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å—Ç—Ä–∏–º–æ–≤'
            },
            {
                level: 1,
                icon: '‚≠ê',
                name: '–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –∏ –≤—ã—à–µ',
                description: '–ü–æ–¥–ø–∏—Å—á–∏–∫–∏, VIP, –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã, —Å—Ç—Ä–∏–º–µ—Ä',
                access: '–ö—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø: –ø–æ–¥–ø–∏—Å—á–∏–∫–∏, VIP, –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã, —Å—Ç—Ä–∏–º–µ—Ä',
                when: '–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –¥–ª—è —Å—Ç—Ä–∏–º–æ–≤ —Å –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º–∏'
            },
            {
                level: 2,
                icon: 'üéñÔ∏è',
                name: 'VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –≤—ã—à–µ',
                description: 'VIP, –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã, —Å—Ç—Ä–∏–º–µ—Ä',
                access: '–ö—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø: VIP, –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã, —Å—Ç—Ä–∏–º–µ—Ä',
                when: '–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å'
            },
            {
                level: 3,
                icon: 'üëÆ',
                name: '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Å—Ç—Ä–∏–º–µ—Ä',
                description: '–¢–æ–ª—å–∫–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Å—Ç—Ä–∏–º–µ—Ä',
                access: '–ö—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø: –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Å—Ç—Ä–∏–º–µ—Ä',
                when: '–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞'
            },
            {
                level: 4,
                icon: 'üëë',
                name: '–¢–æ–ª—å–∫–æ —Å—Ç—Ä–∏–º–µ—Ä',
                description: '–¢–æ–ª—å–∫–æ —Å—Ç—Ä–∏–º–µ—Ä',
                access: '–ö—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø: —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–∏–º–µ—Ä',
                when: '–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤'
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initRoleCards();
                loadAllSettings();
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadAllSettings() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ (—ç—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –∏—Ö –≤ –ø–∞–º—è—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
                await makeRequest('/api/settings/load', 'POST');
                
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å settings.json –Ω–∞–ø—Ä—è–º—É—é
                await loadSettingsFromFile();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await loadUserLists();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ —Ñ–∞–π–ª–∞ settings.json
        async function loadSettingsFromFile() {
            try {
                const response = await fetch(SERVER_URL + '/settings.json');
                if (response.ok) {
                    const settings = await response.json();
                    console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞:', settings);
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ —Ñ–∞–π–ª–∞
                    if (settings.Downloader) {
                        if (settings.Downloader.MaxFileSize) {
                            document.getElementById('file-size').value = settings.Downloader.MaxFileSize;
                        }
                        if (settings.Downloader.DownloadsDirectory) {
                            document.getElementById('folder-path').value = settings.Downloader.DownloadsDirectory;
                        }
                        if (settings.Downloader.Resourse) {
                            document.getElementById('website-address').value = settings.Downloader.Resourse;
                        }
                        if (settings.Downloader.Prefix) {
                            document.getElementById('path-prefix').value = settings.Downloader.Prefix;
                        }
                    }
                    
                    if (settings.IRCClient) {
                        if (settings.IRCClient.ReconnectTimeout) {
                            document.getElementById('reconnect-delay').value = settings.IRCClient.ReconnectTimeout;
                        }
                        if (settings.IRCClient.JoinedChannels && settings.IRCClient.JoinedChannels.length > 0) {
                            // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª
                            document.getElementById('chat-room').value = settings.IRCClient.JoinedChannels[0];
                        }
                    }
                    
                    if (settings.UserVerificator) {
                        if (settings.UserVerificator.RolefilterLevel !== undefined) {
                            selectedRoleLevel = settings.UserVerificator.RolefilterLevel;
                            selectRole(selectedRoleLevel);
                            initRoleCards();
                        }
                        if (settings.UserVerificator.WhiteListOnly !== undefined) {
                            document.getElementById('trusted-only').value = settings.UserVerificator.WhiteListOnly.toString();
                        }
                    }
                } else {
                    console.log('–§–∞–π–ª settings.json –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ settings.json:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUserLists() {
            try {
                const whiteListResult = await makeRequest('/api/white_list/users', 'GET');
                const blackListResult = await makeRequest('/api/black_list/users', 'GET');
                
                if (whiteListResult.success) {
                    try {
                        const whiteList = JSON.parse(whiteListResult.message);
                        console.log('–ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫:', whiteList);
                        // –ú–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞:', e);
                    }
                }
                
                if (blackListResult.success) {
                    try {
                        const blackList = JSON.parse(blackListResult.message);
                        console.log('–ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫:', blackList);
                        // –ú–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞:', e);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ä–æ–ª–µ–π
        function initRoleCards() {
            const container = document.getElementById('role-options');
            container.innerHTML = '';

            roles.forEach(role => {
                const card = document.createElement('div');
                card.className = `role-card ${role.level === selectedRoleLevel ? 'selected' : ''}`;
                card.dataset.level = role.level;
                card.onclick = () => selectRole(role.level);

                card.innerHTML = `
                    <div class="role-header">
                        <span class="role-icon">${role.icon}</span>
                        <span class="role-name">${role.name}</span>
                        <span class="role-level">–£—Ä–æ–≤–µ–Ω—å ${role.level}</span>
                    </div>
                    <div class="role-description">${role.description}</div>
                    <div class="role-access">${role.access}</div>
                `;

                container.appendChild(card);
            });
        }

        // –í—ã–±–æ—Ä —Ä–æ–ª–∏
        function selectRole(level) {
            selectedRoleLevel = level;

            document.querySelectorAll('.role-card').forEach(card => {
                if (parseInt(card.dataset.level) === level) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        async function saveDirectorySettings() {
            const path = document.getElementById('folder-path').value.trim();
            if (!path) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ');
                return;
            }

            const result = await makeRequest('/api/downloader/settings/folder', 'PUT', { Path: path });

            if (result.success) {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        async function saveFileSize() {
            const size = parseInt(document.getElementById('file-size').value);
            if (isNaN(size) || size < 50 || size > 1024) {
                alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 50 –¥–æ 1024 MB');
                return;
            }

            const result = await makeRequest('/api/downloader/settings/max_file_size', 'PUT', {
                FileSize: size
            });

            if (result.success) {
                alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        async function saveDownloaderSource() {
            const website = document.getElementById('website-address').value.trim();
            const prefix = document.getElementById('path-prefix').value.trim();

            if (!website || !prefix) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è');
                return;
            }

            const result = await makeRequest('/api/downloader/settings/resourse_and_prefix', 'PUT', {
                Resourse: website,
                Prefix: prefix
            });

            if (result.success) {
                alert('–ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function saveReconnectTimeout() {
            const delay = parseInt(document.getElementById('reconnect-delay').value);
            if (isNaN(delay) || delay < 10 || delay > 120) {
                alert('–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 10 –¥–æ 120 —Å–µ–∫—É–Ω–¥');
                return;
            }

            const result = await makeRequest('/api/irc_client/settings/set_reconnect_timeout', 'PUT', {
                ReconnectTimeout: delay
            });

            if (result.success) {
                alert('–¢–∞–π–º–∞—É—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.message);
            }
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á–∞—Ç—É
        async function connectToChat() {
            const room = document.getElementById('chat-room').value.trim();
            if (!room) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞');
                return;
            }

            const btn = document.getElementById('connect-btn');
            btn.innerHTML = '<span class="loading-dots"></span> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            btn.disabled = true;

            updateConnectionStatus('connecting', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');

            const result = await makeRequest('/api/irc_client/join', 'POST', {
                Channel: room
            });

            if (result.success) {
                isConnected = true;
                updateConnectionStatus('connected', `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ${room}`);
                alert('–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ' + room);
            } else {
                updateConnectionStatus('disconnected', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + result.message);
            }

            btn.innerHTML = '–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è';
            btn.disabled = false;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(status, text) {
            const dot = document.getElementById('connection-status');
            const textEl = document.getElementById('connection-text');

            dot.className = 'status-dot';
            dot.classList.add(status);
            textEl.textContent = text;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç—É–ø–∞
        async function saveAccessSettings() {
            const trustedOnly = document.getElementById('trusted-only').value === 'true';

            const levelResult = await makeRequest('/api/validator/settings/role_filter_level', 'PUT', {
                RoleFilterLevel: selectedRoleLevel
            });

            const trustedResult = await makeRequest('/api/validator/settings/set_whitelist_only', 'PUT', {
                IsOn: trustedOnly
            });

            if (levelResult.success && trustedResult.success) {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç—É–ø–∞');
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        async function allowUser(button) {
            const username = document.getElementById('allow-user').value.trim();
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            setLoading(button, true);
            const result = await makeRequest('/api/white_list/users', 'PUT', {
                UserName: username
            });

            if (result.success) {
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫`);
                document.getElementById('allow-user').value = '';
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
            setLoading(button, false);
        }

        async function removeAllowedUser(button) {
            const username = document.getElementById('allow-user').value.trim();
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            setLoading(button, true);
            const result = await makeRequest('/api/white_list/users', 'DELETE', {
                UserName: username
            });

            if (result.success) {
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} —É–¥–∞–ª–µ–Ω –∏–∑ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞`);
                document.getElementById('allow-user').value = '';
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
            setLoading(button, false);
        }

        async function blockUser(button) {
            const username = document.getElementById('block-user').value.trim();
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            setLoading(button, true);
            const result = await makeRequest('/api/black_list/users', 'PUT', {
                UserName: username
            });

            if (result.success) {
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`);
                document.getElementById('block-user').value = '';
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
            setLoading(button, false);
        }

        async function removeBlockedUser(button) {
            const username = document.getElementById('block-user').value.trim();
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            setLoading(button, true);
            const result = await makeRequest('/api/black_list/users', 'DELETE', {
                UserName: username
            });

            if (result.success) {
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`);
                document.getElementById('block-user').value = '';
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
            setLoading(button, false);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        async function saveAllSettings() {
            const btn = document.querySelector('.save-all-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading-dots"></span> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            btn.disabled = true;

            try {
                const result = await makeRequest('/api/settings/save', 'POST');

                if (result.success) {
                    alert('–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                } else {
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function setLoading(button, isLoading) {
            if (isLoading) {
                button.innerHTML = '<span class="loading-dots"></span> –û–±—Ä–∞–±–æ—Ç–∫–∞...';
                button.disabled = true;
            } else {
                const originalText = button.textContent.replace('–û–±—Ä–∞–±–æ—Ç–∫–∞...', '').trim();
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        async function makeRequest(endpoint, method, data = null) {
            try {
                const url = SERVER_URL + endpoint;
                console.log(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${method} ${url}`, data);

                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(url, options);
                const result = await response.text();

                console.log(`–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:`, { status: response.status, result });

                return {
                    success: response.ok,
                    message: result,
                    status: response.status
                };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error);
                return {
                    success: false,
                    message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message
                };
            }
        }
    </script>
</body>
</html>

