[Общая архитектура модулей системы](Desing.png)

# TODO

1. IRC Client
2. Downloader
3. HTTP-loopback server
4. FileManager
5. Core
6. GUI

---

## Current Progress

60-65%

---

## Current Task 
 - Отравлять PONG на PING

---


## Task Board


### IRC Client
 - [Always] Рефакторинг. Анализ багов. Написать тесты.
 - Допилить тесты
 - исправить парсинг бейджей пользователя. 
 - полный переход Connetion на ассинхронные операции.
 - сделать ассинхронное подключение
 - сделать ассинхронную запись
 - Проверка соединения.
 - Тестирование.
 - Реализовать хранение каналов, чат которых мы читаем, для возможности отключения
 - вынести реализацию Connection за его объявление

### Downloader
- ассиннхронный подход.
- Проектирование класса загрузчика. вспомогательные классы не нужны.
  - Какой тип запросов делать? GET
  - Как передавать полученный результат в файловую систему? Класс FileManager
  - Какие хосты будут использоваться? https://catboy.best/d/ | https://osu.direct/d/ | api.osucollector.com - API для получения метаданных
  - Нужно ли держать подключение открытым после загрузки? (Проверить, требуется ли переподключение к ресурсу по другому эндпоинту одного и того же хоста.

### HTTP-loopback server
- Решить — синхронный / ассинхронный подход
- Проектирование класса сервера, продумыть вспомогательные классы.
  - Какой будет инвариант класса?
  - Какие нужны эндпоинты?
  - Что будет обрабатывать запросы? RequestHandler
  - Какие будут ответы? (Для фронта)

### FileManager
- Проектирование
- Что будет делать помимо записи на диск?
- Класс-функтор или полноценный класс?

### Core
- Проектирование
- Объекдинение всего функционала в одну систему
- Какой будет порядок?

### GUI
- Андрюха разберется.

---

## Тестирование
- Наверное Макс разберется
- Исправить подсветку ошибок. Не подствечивает отсутсвуюшие символы.
- отрефакторить весь код вывода векторов.

---

## Выполненные задачи

### IRC Client
- Проектирование
- Считать сообщение с сокета
- Понять как его парсить
- реализовать простой парсер
- Создать класс IRC клиент для чтения запросов
- придумать как сделать полиморфизм SSL | noSSL
- Изменить socket_ и ssl_socket_ на std::variant в Client
- Добавить ConnectionVisitor
- Отрефакторить ConnectionVisitor. Редактировать Client::Connect
- Добавить PingPongVisitor. Visitors сделать приватной частью Client
- Добавить ReadMessageVisitor. Редактировать Client::Read, Client::Connect, Client::Pong
- Отрефакторить MessageTypeIdentificator (итерация 1)
- Отрефакторить MessageTypeIdentificator (итерация 2)
- Отрефакторить MessageTypeIdentificator (итерация 3)
- Добавить JoinVisitor. Редактировать Client::Join
- Добавить AuthorizeVisitor. Редактировать Client::Authorize
- Добавить CapReqVisitor. Редактировать Client::CapRequest
- Перенести реализацию методов visitor классов в irc.cpp
- Добавить ca_sertificates_loader для загрузки CA сертификатов
- Добавить тестовые функции в main.cpp (Multichat)
- Исправить выброс str<Null>. Добавить больше тестовых функций (Multichat). Редактировать destructor Client -> Parting каналов, disconnect
- Добавить PartVisitor и создать Client::Part метод
- Проверить main
- Новая архитектура: Client теперь подкласс enable_shared_from_this. Client::Read() теперь асинхронный. Система делает первые шаги к полной асинхронной реализации
- Исправить проблему с CRLF путем эмуляции того, что boost::asio::async_read должен был делать
- [Откат коммита][Приоритетно] Понять насколько сильно повлияли измения связанные с попыткой внедрения классов-друзей для тестирования
- [Изменено]Внедрить и spdlog, для логгирования и nlohmanjson для сериализации данных (для фронта)
- Придумать как разбить класс Client на подклассы, пока он не разросся до безумия.
- Вынести методы работы с сырым сообщением из клиента в отдельный класс MessageProcessor
- [PRIORITET] фикс парсинга сообщений - все логи готовы. Добавить БАЗОВУЮ обработку CAP ответов и STATUSCODE сообщений.
- Разделить message_processor на файлы заголовка и реализации.
- Вынести работу с подключением в отдельный класс Connetion. В клиенте оставить поле shared_ptr<Connection> connection_. В нем будет вся работа с сетью - асинхронное чтение и запись. Возврат сырых данных.
- Разбить Client на хедер и реализацию
- Разбить MessageHandler на хедер и реализацию

 
 

### Downloader
*Пока нет выполненных задач*

### HTTP-loopback server
*Пока нет выполненных задач*

### FileManager
*Пока нет выполненных задач*

### Core
*Пока нет выполненных задач*

### GUI
- Найти хороший референс.


---

## Тестирование
- Сделать CMake таргет тестов
- Написать главную логику тестов через одну функцию сравнения вектора ожидаемых сообщений с фактическим
- Супер быстро накидать функцию сравнения для тестов с выводом в поток и подсветкой ошибок.

---

## Required
- conan2.*
- CMake

Если конан не настроен или его нет:

```
pip install conan
conan profile detect --force
```

Добавть conan в Path (Если путь скриптов pip еще туда не добавлен).

```
mkdir build && cd build
conan install .. --build=missing --output-folder=. -s build_type=Debug -s compiler.runtime=static
(при первом запуске может занять больше часа. Сборка библиотек Boost и SSL)
cmake .. --preset conan-default
cmake --build .
(Может быть очень много ворнингов. Это ок)
```
  
  
